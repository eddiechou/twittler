<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="styles.css">
    <script src="jquery.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Pacifico" rel="stylesheet">
    <script src="jquery.timeago.js"></script>
    <script src="data_generator.js"></script>
  </head>
  <body>
    <script>

      $(document).ready(function(){
        var numTweets = 10;

        var $body = $('body');
        $body.html('<header><h1>Twittler</h1></header>');

        // Add update button
        $refreshButtonDiv = $('<div class="button"><button type="button">Update Tweets!</button></div>');
        $body.append($refreshButtonDiv);

        // Add .tweets div to contain all the tweets
        var $tweets = $('<div class="tweets"></div>');
        $tweets.appendTo($body);

        // Append all tweets
        var index = streams.home.length - 1;
        while(index >= 0){
          var tweetInfo = streams.home[index];
          appendNewTweet(tweetInfo);
          index -= 1;
        }
        $('.tweet:odd').toggleClass('orange_border');

        // On update button click, prepend new tweets
        $body.on('click', 'button', function(){
          for(let i=numTweets; i<streams.home.length - 1; i++){
            var tweetInfo = streams.home[i];
            prependNewTweet(tweetInfo);
          }
          numTweets = streams.home.length;

          $('.tweet:odd').toggleClass('orange_border');
        });

        /* Helper Functions */
        // Appends a new tweet to the .tweets div
        function appendNewTweet(tweet) {
          var $tweet = createTweet(tweet);
          $tweet.appendTo($tweets);
          $("time.timeago").timeago();  // Turns <time> elements to contain timeago text
        }

        // Creates the tweet to append
        function createTweet(tweet){
          // Create Individual Tweet
          var $tweet = $('<div class="tweet">');
          var $name = $('<div class="name"><span class="userName">@' + tweet.user + '</span> says:</div>')
          var $message = $('<blockquote class="message">' + tweet.message.trim() + '</blockquote>');
          var $timestamp = $('<div><span>These <em>wise</em> words were proclaimed: </span><time class="timeago" datetime="' + tweet.created_at.toISOString() + '"></time>.</div>');

          $tweet.append($name);
          $tweet.append($message);
          $tweet.append($timestamp);
          $tweet.append('</div>');

          return $tweet;
        }

        // Prepends a new tweet to the .tweets div
        function prependNewTweet(tweet) {
          var $tweet = createTweet(tweet);
          $tweet.prependTo($tweets);
          $("time.timeago").timeago();
        }

      });

    </script>
  </body>
</html>
