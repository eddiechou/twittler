<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="styles.css">
    <script src="jquery.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Pacifico" rel="stylesheet">
    <script src="jquery.timeago.js"></script>
    <script src="data_generator.js"></script>
  </head>
  <body>
    <script>

      $(document).ready(function(){
        var numTweets = 10;

        var $body = $('body');
        $body.html('<h1>Twittler</h1>');

        $refreshButton = $('<button type="button">Update Tweets!</button>');
        $body.append($refreshButton);
        // Add .tweets div to contain all the tweets
        var $tweets = $('<div class="tweets"></div>');
        $tweets.appendTo($body);

        // Append all tweets
        var index = streams.home.length - 1;
        while(index >= 0){
          var tweetInfo = streams.home[index];
          appendNewTweet(tweetInfo);
          index -= 1;
        }

        $body.on('click', 'button', function(){
          for(let i=numTweets; i<streams.home.length - 1; i++){
            var tweetInfo = streams.home[i];
            prependNewTweet(tweetInfo);
          }
          numTweets = streams.home.length - 1;
        });

        // Appends a new tweet to the .tweets div
        function appendNewTweet(tweet) {
          var $tweet = createTweet(tweet);
          $tweet.appendTo($tweets);
          $("time.timeago").timeago();  // Turns <time> elements to contain timeago text
        }

        // Creates the tweet to append
        function createTweet(tweet){
          // Create Individual Tweet
          var $tweet = $('<div class="tweet">');
          var $nameSpan = $('<span class="userName">@' + tweet.user + '</span>');
          var $message = $('<span class="message">' + tweet.message.trim() + '</span>');
          var $timestamp = $('<time class="timeago" datetime="' + tweet.created_at.toISOString() + '"></time>');

          $tweet.append($nameSpan);
          $tweet.append($message);
          $tweet.append($timestamp);
          $tweet.append('</div>');

          return $tweet;
        }

        // Prepends a new tweet to the .tweets div
        function prependNewTweet(tweet) {
          var $tweet = createTweet(tweet);
          $tweet.prependTo($tweets);
          $("time.timeago").timeago();
        }

      });

    </script>
  </body>
</html>
